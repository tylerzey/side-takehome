name: Check & Test

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:

env:
  STAGE: dev
  VITE_PUBLIC_STAGE: dev
  MONGO_URI: mongodb://127.0.0.1:27017/properties
  SIMPLYRETS_API_URL: https://api.simplyrets.com
  SIMPLYRETS_API_USERNAME: simplyrets
  SIMPLYRETS_API_PASSWORD: simplyrets
  PORT: 4000

jobs:
  checks:
    runs-on: ubuntu-latest
    timeout-minutes: 25

    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ¬ Config node
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'

      - name: ğŸ“¥ Download deps
        run: yarn --frozen-lockfile --silent

      - name: ğŸ§¬ Codegen
        run: yarn codegen

      - name: ğŸ§ª TypeCheck Code
        run: yarn type-check

      - name: ğŸ§¹ Lint Code
        run: yarn lint

      - name: ğŸ“œ Check for Security Vulnerabilities
        run: yarn security-check

      - name: ğŸ§³ Check Build
        run: yarn build

  test:
    runs-on: ubuntu-latest
    timeout-minutes: 25

    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ¬ Config node
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'

      - name: ğŸ“¥ Download deps
        run: yarn --frozen-lockfile --silent

      - name: ğŸ§¬ Codegen
        run: yarn codegen

      - name: ğŸ§ª Test Code
        run: yarn test
